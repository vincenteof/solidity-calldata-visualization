# 项目上下文：Solidity Calldata 可视化工具

## 项目概述

这是一个使用 Next.js、TypeScript 和 TailwindCSS 构建的 Web 应用，其目的是为 Solidity 函数的 ABI 编码 calldata 提供一个清晰、可视化的分解视图。其核心的编码和解析逻辑高度依赖 `viem` 库。

- **前端 UI:** `app/page.tsx`
- **核心编码逻辑:** `lib/calldata-encoder.ts`
- **运行方式:** `pnpm dev`

## 开发历程总结

本次会话通过一个迭代过程，实现并完善了 calldata 的可视化功能，其核心目标是以用户友好的方式，精确地展示 ABI 编码规范。

### 关键里程碑:

1.  **初期分析与 Bug 修复:**
    *   分析了项目结构与依赖项。
    *   修复了 `bool` 类型参数未能从字符串（“true”/“false”）正确解析的 bug。
    *   修复了过长的描述文本会溢出卡片容器的 bug。

2.  **核心逻辑重构 (`lib/calldata-encoder.ts`):**
    *   初始逻辑比较简单，只能提供基础的分解。
    *   后续进行了重大重构，以正确实现 ABI 的 head-tail 模式。最终的逻辑能够精确地将 head 部分（静态值和动态偏移量）与 tail 部分（动态类型的实际数据）分离开，并能递归解析 tail 部分的内容。

3.  **UI/UX 优化 (`app/page.tsx`):**
    *   **初始状态:** 一个简单的编码后部分列表。
    *   **最终决定:** 根据用户的要求，最终移除了辅助线，将 UI 恢复到了**带缩进的扁平列表**的模型。我们一致认为这是最清晰、最稳定且最有效的可视化方案。

4.  **功能增强与精度提升:**
    *   **数组支持**: 
        *   在 `app/page.tsx` 中实现了对数组类型（如 `address[]`）的逗号分隔输入支持。
        *   在 `lib/calldata-encoder.ts` 的 `parseDynamicData` 中，实现了对动态数组的正确分解，可以清晰地展示数组的长度和每一个元素。
    *   **精确补零**: 
        *   为静态类型（`uintN`, `address`, `bytesN`）实现了正确的左/右补零，使其在可视化中始终显示为 32 字节。
        *   为动态类型（`string`, `bytes`）的数据部分实现了正确的右补零，以对齐到 32 字节的倍数，精确反映了其在 calldata 中的存储方式。

## 最终状态

项目目前处于一个稳定且功能完整的状态。

-   **功能性:** 应用能够正确解析函数签名和参数，包括复杂的、嵌套的静态与动态 `struct`，以及静态元素类型的动态数组。
-   **Calldata 逻辑:** `lib/calldata-encoder.ts` 中的分解逻辑精确地反映了 ABI 的 head-tail 规范，并能正确解析 `string`, `bytes` 和数组等动态类型，包括它们的长度、内容和补零。
-   **UI 展示:** `app/page.tsx` 中的 UI 将分解结果渲染为一个干净的扁平列表。它使用缩进来直观地表示数据的层级结构，被证明是清晰、稳定且有效的可视化方案。

继任者可以将此版本视为最终的权威版本。任何关于视觉增强的进一步工作都应谨慎进行。